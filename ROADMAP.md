# 기후안전허브 고도화 로드맵

MVP 이후 단계별 개발 계획을 정리한 문서입니다.

---

## 목차

1. [Phase 1: 백엔드 인프라 구축](#phase-1-백엔드-인프라-구축)
2. [Phase 2: 관리자 시스템](#phase-2-관리자-시스템)
3. [Phase 3: 포인트 시스템 고도화](#phase-3-포인트-시스템-고도화)
4. [Phase 4: 파일/이미지 관리](#phase-4-파일이미지-관리)
5. [Phase 5: 데이터 분석 및 시각화](#phase-5-데이터-분석-및-시각화)
6. [Phase 6: 사용자 경험 개선](#phase-6-사용자-경험-개선)
7. [Phase 7: 확장 기능](#phase-7-확장-기능)

---

## Phase 1: 백엔드 인프라 구축

### 1.1 서버 구축 (현재: Firebase만 사용)

**필요성**: 복잡한 비즈니스 로직, 외부 API 연동, 보안 처리

**기술 스택 옵션**:
| 옵션 | 장점 | 단점 |
|------|------|------|
| Firebase Functions | Firebase 생태계 통합, 서버리스 | Cold start, 복잡한 로직 한계 |
| Node.js + Express | 유연성, 풍부한 생태계 | 서버 관리 필요 |
| Next.js API Routes | 프론트엔드 통합, Vercel 배포 용이 | 대규모 트래픽 시 비용 |
| NestJS | 구조화된 아키텍처, TypeScript | 학습 곡선 |

**구현 항목**:
- [ ] API 서버 셋업
- [ ] 인증 미들웨어 (JWT 토큰 검증)
- [ ] 요청 유효성 검사 (Zod, Joi)
- [ ] 에러 핸들링 표준화
- [ ] 로깅 시스템 (Winston, Pino)
- [ ] Rate Limiting (API 호출 제한)

### 1.2 데이터베이스 설계 고도화

**현재**: Firestore (NoSQL)

**추가 고려사항**:
```
users (사용자)
├── uid (PK)
├── email
├── displayName
├── profileImage
├── userType: citizen | business | admin
├── points
├── level
├── reportCount
├── verifiedAt (본인인증 완료일)
├── marketingAgree (마케팅 수신 동의)
├── createdAt
└── updatedAt

reports (제보)
├── id (PK)
├── userId (FK)
├── type: flood | drain | etc
├── status: pending | reviewing | approved | rejected | completed
├── location
│   ├── address
│   ├── addressDetail
│   ├── lat
│   └── lng
├── description
├── images[] (이미지 URL 배열)
├── contact
├── points (적립 포인트)
├── reviewedBy (검토자 admin uid)
├── reviewNote (검토 메모)
├── createdAt
└── updatedAt

point_transactions (포인트 거래내역)
├── id (PK)
├── userId (FK)
├── type: earn | spend | expire
├── amount
├── balance (거래 후 잔액)
├── reason: report | bonus | reward_use | admin_adjust
├── relatedId (관련 제보/상품 ID)
├── createdAt
└── expiresAt (유효기간)

rewards (리워드 상품)
├── id (PK)
├── name
├── description
├── pointCost
├── category: local_currency | discount | donation
├── partnerId (협력업체 ID)
├── stock (재고)
├── imageUrl
├── isActive
├── createdAt
└── updatedAt

reward_orders (리워드 교환내역)
├── id (PK)
├── userId (FK)
├── rewardId (FK)
├── pointsUsed
├── status: pending | completed | cancelled
├── usedAt
└── createdAt

partners (협력기업)
├── id (PK)
├── companyName
├── businessNumber
├── contactName
├── contactEmail
├── contactPhone
├── category
├── description
├── logoUrl
├── website
├── status: pending | approved | rejected
├── createdAt
└── updatedAt

notifications (알림)
├── id (PK)
├── userId (FK)
├── type: report_status | point_earned | system
├── title
├── message
├── isRead
├── createdAt
└── readAt
```

### 1.3 보안 강화

**서버 측 검증 (필수)**:
- [ ] 입력값 검증 (XSS, SQL Injection 방지)
- [ ] 파일 업로드 검증 (확장자, 크기, MIME 타입)
- [ ] API 인증/인가 체크
- [ ] CORS 설정
- [ ] HTTPS 강제

**추가 보안**:
- [ ] Firebase Security Rules 강화
- [ ] 민감 데이터 암호화
- [ ] API Key 환경변수 관리
- [ ] 로그인 시도 제한 (브루트포스 방지)

---

## Phase 2: 관리자 시스템

> **현재 상태**: 기본 관리자 페이지 구현 완료 (2025.01)

### 2.1 관리자 대시보드

**접근**: `/admin` (별도 라우트)

**인증**:
- [x] 관리자 이메일 기반 접근 제어 (AdminLayout)
- [ ] 관리자 계정 분리 (userType: admin)
- [ ] 2단계 인증 (OTP)
- [ ] 관리자 활동 로그

### 2.2 대시보드 기능 (완료)

**메인 대시보드**:
```
┌─────────────────────────────────────────────────┐
│  기후안전허브 관리자                              │
├─────────────────────────────────────────────────┤
│  📊 오늘 통계                                    │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐           │
│  │신규가입│ │신규제보│ │처리완료│ │총포인트│          │
│  │  12명 │ │  8건  │ │  5건  │ │ 1,250P│          │
│  └──────┘ └──────┘ └──────┘ └──────┘           │
│                                                 │
│  📈 주간 추이 그래프                              │
│  [차트 영역]                                     │
│                                                 │
│  🚨 긴급 처리 필요                               │
│  • 미검토 제보 3건                               │
│  • 문의 대기 2건                                 │
└─────────────────────────────────────────────────┘
```

### 2.3 제보 관리

**제보 목록**:
- [x] 전체 제보 조회 (필터: 상태, 유형)
- [x] 제보 상세 보기
- [ ] 지도에서 제보 위치 확인
- [ ] 이미지 확대 보기

**제보 처리**:
- [x] 상태 변경 (대기중 → 검토중 → 완료/반려)
- [ ] 검토 메모 작성
- [ ] 우수 제보 선정 (추가 포인트 지급)
- [ ] 반려 시 사유 입력 및 알림

**일괄 처리**:
- [ ] 다중 선택 후 상태 일괄 변경
- [ ] CSV/Excel 내보내기

### 2.4 회원 관리

**회원 목록**:
- [x] 전체 회원 조회 (필터: 등급)
- [x] 회원 상세 정보 보기
- [x] 회원 검색 (이메일, 이름)
- [ ] 회원별 제보/포인트 내역

**회원 관리 기능**:
- [ ] 포인트 수동 지급/차감
- [ ] 등급 수동 조정
- [ ] 계정 정지/해제
- [ ] 회원 탈퇴 처리

### 2.5 포인트/리워드 관리

**포인트**:
- [ ] 포인트 지급 내역 조회
- [ ] 수동 포인트 지급
- [ ] 포인트 만료 정책 설정

**리워드 상품**:
- [ ] 상품 등록/수정/삭제
- [ ] 재고 관리
- [ ] 상품 노출 순서 관리

**교환 내역**:
- [ ] 교환 신청 목록
- [ ] 교환 처리 (발송 완료 등)

### 2.6 협력기업 관리

- [ ] 기업 가입 신청 목록
- [ ] 기업 정보 승인/반려
- [ ] 기업별 리워드 상품 관리

### 2.7 콘텐츠 관리

- [ ] 공지사항 등록/수정
- [ ] FAQ 관리
- [ ] 배너/팝업 관리

### 2.8 통계/리포트

**대시보드 통계**:
- [ ] 일별/주별/월별 가입자 수
- [ ] 제보 현황 (유형별, 지역별)
- [ ] 포인트 발행/사용 현황
- [ ] 리워드 교환 현황

**리포트 생성**:
- [ ] 기간별 리포트 생성
- [ ] PDF/Excel 다운로드
- [ ] 정기 리포트 이메일 발송

---

## Phase 3: 포인트 시스템 고도화

### 3.1 포인트 정책

**적립 규칙**:
| 활동 | 기본 포인트 | 보너스 조건 |
|------|-------------|-------------|
| 제보 등록 | +10P | - |
| 우수 제보 선정 | +20P | 관리자 선정 |
| 제보 반영 완료 | +5P | 실제 지도 반영 시 |
| 첫 제보 | +30P | 신규 가입 후 첫 제보 |
| 친구 초대 | +50P | 초대받은 친구가 첫 제보 완료 시 |
| 출석 체크 | +1P | 일일 1회 |
| 이벤트 참여 | 변동 | 이벤트별 상이 |

**차감/만료**:
- [ ] 리워드 교환 시 차감
- [ ] 포인트 유효기간 (예: 적립일로부터 1년)
- [ ] 만료 예정 알림 (30일 전)

### 3.2 등급 시스템

**등급 기준**:
| 등급 | 조건 | 혜택 |
|------|------|------|
| 브론즈 🥉 | 0P ~ 199P | 기본 |
| 실버 🥈 | 200P ~ 499P | 리워드 5% 할인 |
| 골드 🥇 | 500P ~ 999P | 리워드 10% 할인 |
| 플래티넘 💎 | 1000P 이상 | 리워드 15% 할인 + 전용 상품 |

**등급 혜택**:
- [ ] 리워드 할인율 차등
- [ ] 등급별 전용 리워드
- [ ] 등급 유지 조건 (6개월 내 활동)
- [ ] 등급 하락 방지 기간

### 3.3 리워드 상점

**상품 카테고리**:
```
리워드 상점
├── 지역화폐
│   ├── 경기지역화폐 5,000원 (500P)
│   ├── 경기지역화폐 10,000원 (950P)
│   └── ...
├── 제휴 할인
│   ├── 스타벅스 아메리카노 (450P)
│   ├── 편의점 상품권 (300P)
│   └── ...
├── 공공시설
│   ├── 체육관 이용권 (200P)
│   ├── 도서관 대출권 연장 (100P)
│   └── ...
└── 기부
    ├── 기후안전 기금 1,000원 기부 (100P)
    └── 나무 심기 캠페인 (500P)
```

**교환 프로세스**:
1. 상품 선택 → 포인트 차감 → 쿠폰/바코드 발급
2. 실물 상품: 배송지 입력 → 발송

### 3.4 외부 연동 (쇼핑몰/지역화폐)

**지역화폐 연동**:
- [ ] 경기지역화폐 API 연동
- [ ] 실시간 잔액 조회
- [ ] 포인트 → 지역화폐 전환

**제휴사 연동**:
- [ ] 쿠폰 발급 API (기프티콘 등)
- [ ] 사용 여부 확인 콜백
- [ ] 미사용 쿠폰 환불 처리

---

## Phase 4: 파일/이미지 관리

### 4.1 스토리지 선택

**옵션 비교**:
| 서비스 | 장점 | 단점 | 비용 |
|--------|------|------|------|
| Firebase Storage | Firebase 통합 | Blaze 플랜 필요 | 사용량 기반 |
| AWS S3 | 안정성, 확장성 | 설정 복잡 | 저렴 |
| Cloudinary | 이미지 최적화 내장 | 용량 제한 | 프리티어 있음 |
| Supabase Storage | PostgreSQL 통합 | 상대적 신규 | 무료 티어 넉넉 |

### 4.2 이미지 업로드 구현

**업로드 플로우**:
```
사용자 이미지 선택
    ↓
클라이언트 사전 검증
- 파일 크기 (최대 10MB)
- 파일 형식 (jpg, png, webp)
- 이미지 크기 (최대 4096x4096)
    ↓
이미지 리사이징/압축 (클라이언트)
- 썸네일 생성 (300x300)
- 원본 리사이징 (최대 1920px)
    ↓
서버 업로드
    ↓
서버 검증
- MIME 타입 재검증
- 악성코드 스캔 (선택)
- EXIF 데이터 제거 (위치정보 등)
    ↓
스토리지 저장
- 고유 파일명 생성 (UUID)
- CDN URL 반환
```

**구현 항목**:
- [ ] 클라이언트 이미지 압축 (browser-image-compression)
- [ ] 드래그 앤 드롭 업로드
- [ ] 업로드 진행률 표시
- [ ] 다중 이미지 업로드 (최대 5장)
- [ ] 이미지 미리보기
- [ ] 이미지 삭제

### 4.3 이미지 최적화

**CDN 설정**:
- [ ] CloudFlare 또는 AWS CloudFront 연동
- [ ] 이미지 캐싱 정책

**자동 최적화**:
- [ ] WebP 자동 변환
- [ ] 반응형 이미지 (srcset)
- [ ] Lazy Loading

---

## Phase 5: 데이터 분석 및 시각화

### 5.1 분석 도구 연동

**기본 분석**:
- [ ] Google Analytics 4 연동
- [ ] 페이지뷰, 이벤트 추적
- [ ] 전환 목표 설정 (제보 완료, 회원가입)

**상세 분석**:
- [ ] Mixpanel 또는 Amplitude 연동
- [ ] 사용자 여정 분석
- [ ] 퍼널 분석 (가입 → 로그인 → 제보)
- [ ] 코호트 분석

### 5.2 내부 통계 대시보드

**실시간 모니터링**:
- [ ] 동시 접속자 수
- [ ] 실시간 제보 현황
- [ ] 서버 상태 모니터링

**리포트 자동화**:
- [ ] 일간/주간 리포트 자동 생성
- [ ] 이메일 발송
- [ ] Slack 알림 연동

### 5.3 지도 데이터 고도화

**제보 데이터 시각화**:
- [ ] 제보 밀집도 히트맵
- [ ] 시간대별 제보 추이
- [ ] 지역별 위험도 자체 산출

**공공 데이터 추가 연동**:
- [ ] 기상청 실시간 강수량
- [ ] 하천 수위 정보
- [ ] 재난 문자 연동

---

## Phase 6: 사용자 경험 개선

### 6.1 알림 시스템

**푸시 알림**:
- [ ] Firebase Cloud Messaging (FCM) 연동
- [ ] 웹 푸시 알림 구현
- [ ] 알림 설정 (수신 동의/거부)

**알림 유형**:
| 유형 | 내용 | 타이밍 |
|------|------|--------|
| 제보 상태 변경 | "제보가 검토 중입니다" | 상태 변경 시 |
| 포인트 적립 | "+10P 적립되었습니다" | 적립 시 |
| 포인트 만료 예정 | "30일 후 100P 만료" | 만료 30일 전 |
| 등급 변경 | "실버 등급으로 승급!" | 승급 시 |
| 긴급 재난 | "우리 동네 호우 경보" | 기상 특보 시 |

### 6.2 PWA (Progressive Web App)

**구현 항목**:
- [ ] Service Worker 설정
- [ ] 오프라인 지원 (기본 페이지 캐싱)
- [ ] 앱 설치 프롬프트
- [ ] 홈 화면 아이콘

### 6.3 접근성 개선

- [ ] 스크린 리더 지원
- [ ] 키보드 네비게이션
- [ ] 고대비 모드
- [ ] 글꼴 크기 조절

### 6.4 다국어 지원

- [ ] i18n 라이브러리 적용 (react-i18next)
- [ ] 한국어/영어 지원
- [ ] 언어 자동 감지

---

## Phase 7: 확장 기능

### 7.1 소셜 기능

**커뮤니티**:
- [ ] 제보 댓글/공감
- [ ] 사용자 간 팔로우
- [ ] 활동 피드
- [ ] 랭킹 시스템 (월간 베스트 제보자)

**공유 기능**:
- [ ] 제보 SNS 공유
- [ ] 초대 링크 생성
- [ ] 공유 시 포인트 적립

### 7.2 기업 전용 기능

**기업 대시보드**:
- [ ] 기업 프로필 관리
- [ ] 리워드 상품 등록
- [ ] 판매/교환 현황 조회
- [ ] 정산 내역 확인

**B2B 기능**:
- [ ] 기업 맞춤 솔루션 문의
- [ ] 견적 요청
- [ ] 계약 관리

### 7.3 API 공개

**Open API**:
- [ ] 제보 데이터 조회 API
- [ ] 침수 위험 정보 API
- [ ] API 키 발급 시스템
- [ ] 사용량 제한 및 과금

### 7.4 AI/ML 적용

**이미지 분석**:
- [ ] 침수 사진 자동 분류
- [ ] 위험도 자동 판정
- [ ] 중복 제보 감지

**예측 모델**:
- [ ] 지역별 침수 위험 예측
- [ ] 제보 트렌드 예측
- [ ] 이상 징후 감지

### 7.5 네이티브 앱

**앱 개발 옵션**:
| 방식 | 장점 | 단점 |
|------|------|------|
| React Native | 코드 재사용, 빠른 개발 | 네이티브 대비 성능 |
| Flutter | 뛰어난 UI, 빠른 성능 | Dart 학습 필요 |
| 네이티브 (Swift/Kotlin) | 최고 성능 | 개발 비용 높음 |

**앱 전용 기능**:
- [ ] 카메라 직접 연동
- [ ] GPS 자동 위치
- [ ] 백그라운드 알림
- [ ] 오프라인 모드

---

## 우선순위 추천

### 완료
- [x] **관리자 페이지 기본** - 대시보드, 제보 관리, 회원 관리

### 즉시 (1~2개월)
1. **Firebase Storage 활성화** - 이미지 업로드 (Blaze 플랜 업그레이드)
2. **서버 검증 추가** - Firebase Functions로 기본 검증
3. **관리자 기능 고도화** - 포인트 수동 지급, 검토 메모

### 단기 (3~6개월)
4. **포인트 거래 내역** - 적립/사용 히스토리
5. **알림 시스템** - 이메일 + 웹 푸시
6. **리워드 상점 기본** - 기부 옵션부터 시작
7. **관리자 통계** - 기본 대시보드

### 중기 (6~12개월)
8. **지역화폐 연동** - 경기지역화폐 API
9. **PWA 적용** - 앱 설치 경험
10. **API 서버 분리** - Node.js/NestJS
11. **제휴사 연동** - 기프티콘 발급

### 장기 (1년 이후)
12. **네이티브 앱** - React Native
13. **AI 이미지 분석** - 자동 분류
14. **Open API** - 외부 개발자용
15. **B2B 기능** - 기업 대시보드

---

## 예상 리소스

### 개발 인력
| 역할 | MVP | 고도화 Phase 1~3 | 전체 |
|------|-----|------------------|------|
| 프론트엔드 | 1명 | 1~2명 | 2명 |
| 백엔드 | 0명 | 1명 | 1~2명 |
| 디자이너 | 0.5명 | 1명 | 1명 |
| PM | 0.5명 | 1명 | 1명 |

### 인프라 비용 (월 예상)
| 항목 | MVP | 고도화 |
|------|-----|--------|
| Firebase (Spark) | 무료 | - |
| Firebase (Blaze) | - | $50~200 |
| Vercel | 무료 | $20~50 |
| 도메인 | $15/년 | $15/년 |
| 외부 API | - | $100~500 |
| **합계** | ~무료 | $200~800/월 |

---

*마지막 업데이트: 2025년 1월 (관리자 페이지 추가)*
